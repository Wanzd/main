<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pd.it.module.economic.detail.IEconomicDetailDao">

	<select id="rs" parameterType="VO" resultType="VO">
select 
	flow_id as "flowId",
	year as "year",
	month as "month",
	day as "day",
	person as "person",
	event_type as "eventType",
	t2.cn as "evenTypeCn",
	event_class as "eventClass",
	t3.cn as "evenClassCn",
	qty as "qty",
	detail as "detail"
from economic_detail_t t1
left join sys_lookupitem_t t2
	on t2.type_id='economic_eventClass'
	and t2.id=t1.event_type
left join sys_lookupitem_t t3
	on t3.type_id='economic_eventType'
	and t3.id=t1.event_class
		<include refid="rs$filter"/>
	</select>

	<update id="us">
replace into economic_detail_t(
	flow_id,
	year,
	month,
	day,
	person,
	event_type,
	event_class,
	qty,
	detail
)
values
		<foreach item="it" index="index" collection="list" 
			separator=",">
	(
		#{it.flowId},
		#{it.year,jdbcType=NUMERIC},
		#{it.month,jdbcType=NUMERIC},
		#{it.day,jdbcType=NUMERIC},
		#{it.person},
		#{it.eventType},
		#{it.eventClass},
		#{it.qty},
		#{it.detail}
	)
		</foreach>

	</update>
	<delete id="ds">
delete from economic_detail_t
where (flow_id) in(
		<foreach item="it" collection="list" 
			separator=",">
	(${it.flowId})
		</foreach>
)
	</delete>
	<sql id="rs$filter">
		<where>
			<choose>
				<when test="fo.month!=null and fo.month !=''">
					year=left(#{fo.month},4)
					and month=right(#{fo.month},2)
				</when>
				<otherwise>
					1=0
				</otherwise>
			</choose>
			
		</where>
	</sql>
</mapper>  